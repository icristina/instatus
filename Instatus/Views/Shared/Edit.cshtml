@{
    Layout = "~/Views/Shared/_Bootstrap.cshtml";
    ViewBag.Title = Model.ToString();

    var webForm = (WebForm)ViewData["form"];
}

@section head {
    @Html.Stylesheet("scaffold.css")
}

@section scripts {
    @Html.Scripts("scaffold.js")
}

@section nav {
    @{
        var navigation = ViewData["navigation"] as SiteMapNodeCollection;    
    }
    @if (navigation != null) {
        <nav class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">    
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <div class="nav-collapse">
                        @Html.Partial("Nav", navigation, new WebFormatting() { MaxLength = 6 })
                        @Html.Partial("LoginStatus")
                    </div>
                </div>
            </div>
        </nav>   
    }
}

@helper Edit() {
    var webForm = (WebForm)ViewData["form"];
    foreach (var parameter in webForm.HiddenParameters) {
        @Html.Hidden(parameter.Name, parameter.Content)    
    }    
    <div class="form-actions">
        @Html.SubmitButton(webForm.ActionText, "btn btn-primary")
    </div>
    if (!ViewData.ModelState.IsValid)
    {
        <p class="alert">
            @ViewData.ModelState.FirstErrorMessage()
        </p>
    }        
    @Html.EditorForModel()    
}

<div class="container">
    @if (ViewData.ModelMetadata.AdditionalValues.Value("File").AsBoolean())
    {
        using (Html.BeginMultipartForm(className: "form-horizontal"))
        {
            @Edit()
        }
    }
    else
    {
        using (Html.BeginForm(webForm.ActionName, ViewContext.RouteData.ControllerName(), FormMethod.Post, new { @class = "form-horizontal" }))
        {
            @Edit()
        }
    }
</div>